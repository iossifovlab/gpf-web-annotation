<div id="wrapper-container">
  <div id="annotation-container">
    <div class="sticky-elements">
      <div *ngIf="hideComponents">
        <button id="show-components" (click)="showComponents()"
          ><span class="material-symbols-outlined show-components-icon">right_panel_open</span></button
        >
      </div>
      <app-annotation-pipeline
        (emitPipelineId)="setPipeline($event)"
        (emitIsConfigValid)="setConfigValid($event)"
        (tiggerHidingComponents)="updateComponentsVisibility($event)"></app-annotation-pipeline>
    </div>

    <div
      [style.visibility]="hideComponents ? 'hidden' : 'visible'"
      style="display: flex; flex-direction: column; width: auto; min-width: 0; flex-grow: 1">
      <div id="annotation-mode">
        <button
          id="single-allele-annotations"
          (click)="switchView('single allele')"
          [ngClass]="currentView === 'single allele' ? 'active-view' : 'inactive-view'"
          >Single allele annotation</button
        >
        <button
          id="annotation-jobs"
          (click)="switchView('jobs')"
          [ngClass]="currentView === 'jobs' ? 'active-view' : 'inactive-view'"
          >Annotation jobs</button
        >
      </div>

      <div *ngIf="currentView === 'jobs'">
        <div *ngIf="isCreationFormVisible">
          <app-job-creation
            (emitFile)="setFile($event)"
            (emitFileSeparator)="setFileSeparator($event)"
            (emitGenome)="setGenome($event)"
            (emitUpdatedFileHeader)="setUpdatedFileHeader($event)"></app-job-creation>
          <div style="margin-top: 10px">
            <span class="error-message">{{ creationError }}</span>
            <button id="create-button" (click)="autoSavePipeline()" tabindex="1" [disabled]="disableCreate()"
              >Create</button
            >
          </div>
        </div>

        <div *ngIf="!isCreationFormVisible && currentJob" id="result">
          <div id="current-job-info">
            <div>
              <span class="job-name">Job name: {{ currentJob.name }}</span>
              <span class="status-label" [ngClass]="getStatusClass()">{{ currentJob.status }}</span>
            </div>
            <div *ngIf="currentJob.status === 'success'">
              <span id="file-name">{{ currentJob.annotatedFileName }}</span>
              <a id="download-result" [href]="downloadLink" download
                ><span class="material-symbols-outlined download-icon">download</span></a
              >
            </div>
          </div>

          <div id="new-job-section">
            <button id="new-job-button" (click)="showCreateMode()"
              ><span class="material-symbols-outlined">add</span>new job</button
            >
          </div>
        </div>
      </div>

      <div *ngIf="currentView === 'single allele'">
        <app-single-annotation
          (alleleUpdateEmit)="refreshAllelesTable()"
          (autoSaveTrigger)="autoSavePipeline()"></app-single-annotation>
      </div>
    </div>
  </div>

  <div
    *ngIf="isUserLoggedIn"
    [style.visibility]="hideComponents ? 'hidden' : 'visible'"
    id="history-table"
    class="sticky-elements">
    <div>
      <button id="toggle-history" (click)="this.hideHistory = !this.hideHistory"
        ><span
          class="material-symbols-outlined"
          [ngStyle]="{ transform: this.hideHistory ? 'rotate(0deg)' : 'rotate(180deg)' }"
          >right_panel_open</span
        ></button
      >
    </div>
    <div *ngIf="!hideHistory">
      <app-jobs-table *ngIf="currentView === 'jobs'" (jobDelete)="refreshUserQuota()"></app-jobs-table>
      <app-alleles-table
        *ngIf="currentView === 'single allele'"
        (emitAllele)="triggerSingleAlleleAnnotation($event)"></app-alleles-table>
    </div>
  </div>
</div>
